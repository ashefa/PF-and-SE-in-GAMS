sets
n index of buses /n1*n118/;
alias(n,np);
scalar
baseMVA /100/;
table  bus(n,*) bus data
          type     Pd       Qd       Gs       Bs       area     Vm           Va           baseKV     zone     Vmax        Vmin
n1        2        51       27       0        0        1        0.955        10.67        138        1        1.06        0.94
n2        1        20       9        0        0        1        0.971        11.22        138        1        1.06        0.94
n3        1        39       10       0        0        1        0.968        11.56        138        1        1.06        0.94
n4        2        39       12       0        0        1        0.998        15.28        138        1        1.06        0.94
n5        1        0        0        0        -40      1        1.002        15.73        138        1        1.06        0.94
n6        2        52       22       0        0        1        0.99         13           138        1        1.06        0.94
n7        1        19       2        0        0        1        0.989        12.56        138        1        1.06        0.94
n8        2        28       0        0        0        1        1.015        20.77        345        1        1.06        0.94
n9        1        0        0        0        0        1        1.043        28.02        345        1        1.06        0.94
n10       2        0        0        0        0        1        1.05         35.61        345        1        1.06        0.94
n11       1        70       23       0        0        1        0.985        12.72        138        1        1.06        0.94
n12       2        47       10       0        0        1        0.99         12.2         138        1        1.06        0.94
n13       1        34       16       0        0        1        0.968        11.35        138        1        1.06        0.94
n14       1        14       1        0        0        1        0.984        11.5         138        1        1.06        0.94
n15       2        90       30       0        0        1        0.97         11.23        138        1        1.06        0.94
n16       1        25       10       0        0        1        0.984        11.91        138        1        1.06        0.94
n17       1        11       3        0        0        1        0.995        13.74        138        1        1.06        0.94
n18       2        60       34       0        0        1        0.973        11.53        138        1        1.06        0.94
n19       2        45       25       0        0        1        0.963        11.05        138        1        1.06        0.94
n20       1        18       3        0        0        1        0.958        11.93        138        1        1.06        0.94
n21       1        14       8        0        0        1        0.959        13.52        138        1        1.06        0.94
n22       1        10       5        0        0        1        0.97         16.08        138        1        1.06        0.94
n23       1        7        3        0        0        1        1            21           138        1        1.06        0.94
n24       2        13       0        0        0        1        0.992        20.89        138        1        1.06        0.94
n25       2        0        0        0        0        1        1.05         27.93        138        1        1.06        0.94
n26       2        0        0        0        0        1        1.015        29.71        345        1        1.06        0.94
n27       2        71       13       0        0        1        0.968        15.35        138        1        1.06        0.94
n28       1        17       7        0        0        1        0.962        13.62        138        1        1.06        0.94
n29       1        24       4        0        0        1        0.963        12.63        138        1        1.06        0.94
n30       1        0        0        0        0        1        0.968        18.79        345        1        1.06        0.94
n31       2        43       27       0        0        1        0.967        12.75        138        1        1.06        0.94
n32       2        59       23       0        0        1        0.964        14.8         138        1        1.06        0.94
n33       1        23       9        0        0        1        0.972        10.63        138        1        1.06        0.94
n34       2        59       26       0        14       1        0.986        11.3         138        1        1.06        0.94
n35       1        33       9        0        0        1        0.981        10.87        138        1        1.06        0.94
n36       2        31       17       0        0        1        0.98         10.87        138        1        1.06        0.94
n37       1        0        0        0        -25      1        0.992        11.77        138        1        1.06        0.94
n38       1        0        0        0        0        1        0.962        16.91        345        1        1.06        0.94
n39       1        27       11       0        0        1        0.97         8.41         138        1        1.06        0.94
n40       2        66       23       0        0        1        0.97         7.35         138        1        1.06        0.94
n41       1        37       10       0        0        1        0.967        6.92         138        1        1.06        0.94
n42       2        96       23       0        0        1        0.985        8.53         138        1        1.06        0.94
n43       1        18       7        0        0        1        0.978        11.28        138        1        1.06        0.94
n44       1        16       8        0        10       1        0.985        13.82        138        1        1.06        0.94
n45       1        53       22       0        10       1        0.987        15.67        138        1        1.06        0.94
n46       2        28       10       0        10       1        1.005        18.49        138        1        1.06        0.94
n47       1        34       0        0        0        1        1.017        20.73        138        1        1.06        0.94
n48       1        20       11       0        15       1        1.021        19.93        138        1        1.06        0.94
n49       2        87       30       0        0        1        1.025        20.94        138        1        1.06        0.94
n50       1        17       4        0        0        1        1.001        18.9         138        1        1.06        0.94
n51       1        17       8        0        0        1        0.967        16.28        138        1        1.06        0.94
n52       1        18       5        0        0        1        0.957        15.32        138        1        1.06        0.94
n53       1        23       11       0        0        1        0.946        14.35        138        1        1.06        0.94
n54       2        113      32       0        0        1        0.955        15.26        138        1        1.06        0.94
n55       2        63       22       0        0        1        0.952        14.97        138        1        1.06        0.94
n56       2        84       18       0        0        1        0.954        15.16        138        1        1.06        0.94
n57       1        12       3        0        0        1        0.971        16.36        138        1        1.06        0.94
n58       1        12       3        0        0        1        0.959        15.51        138        1        1.06        0.94
n59       2        277      113      0        0        1        0.985        19.37        138        1        1.06        0.94
n60       1        78       3        0        0        1        0.993        23.15        138        1        1.06        0.94
n61       2        0        0        0        0        1        0.995        24.04        138        1        1.06        0.94
n62       2        77       14       0        0        1        0.998        23.43        138        1        1.06        0.94
n63       1        0        0        0        0        1        0.969        22.75        345        1        1.06        0.94
n64       1        0        0        0        0        1        0.984        24.52        345        1        1.06        0.94
n65       2        0        0        0        0        1        1.005        27.65        345        1        1.06        0.94
n66       2        39       18       0        0        1        1.05         27.48        138        1        1.06        0.94
n67       1        28       7        0        0        1        1.02         24.84        138        1        1.06        0.94
n68       1        0        0        0        0        1        1.003        27.55        345        1        1.06        0.94
n69       3        0        0        0        0        1        1.035        30           138        1        1.06        0.94
n70       2        66       20       0        0        1        0.984        22.58        138        1        1.06        0.94
n71       1        0        0        0        0        1        0.987        22.15        138        1        1.06        0.94
n72       2        12       0        0        0        1        0.98         20.98        138        1        1.06        0.94
n73       2        6        0        0        0        1        0.991        21.94        138        1        1.06        0.94
n74       2        68       27       0        12       1        0.958        21.64        138        1        1.06        0.94
n75       1        47       11       0        0        1        0.967        22.91        138        1        1.06        0.94
n76       2        68       36       0        0        1        0.943        21.77        138        1        1.06        0.94
n77       2        61       28       0        0        1        1.006        26.72        138        1        1.06        0.94
n78       1        71       26       0        0        1        1.003        26.42        138        1        1.06        0.94
n79       1        39       32       0        20       1        1.009        26.72        138        1        1.06        0.94
n80       2        130      26       0        0        1        1.04         28.96        138        1        1.06        0.94
n81       1        0        0        0        0        1        0.997        28.1         345        1        1.06        0.94
n82       1        54       27       0        20       1        0.989        27.24        138        1        1.06        0.94
n83       1        20       10       0        10       1        0.985        28.42        138        1        1.06        0.94
n84       1        11       7        0        0        1        0.98         30.95        138        1        1.06        0.94
n85       2        24       15       0        0        1        0.985        32.51        138        1        1.06        0.94
n86       1        21       10       0        0        1        0.987        31.14        138        1        1.06        0.94
n87       2        0        0        0        0        1        1.015        31.4         161        1        1.06        0.94
n88       1        48       10       0        0        1        0.987        35.64        138        1        1.06        0.94
n89       2        0        0        0        0        1        1.005        39.69        138        1        1.06        0.94
n90       2        163      42       0        0        1        0.985        33.29        138        1        1.06        0.94
n91       2        10       0        0        0        1        0.98         33.31        138        1        1.06        0.94
n92       2        65       10       0        0        1        0.993        33.8         138        1        1.06        0.94
n93       1        12       7        0        0        1        0.987        30.79        138        1        1.06        0.94
n94       1        30       16       0        0        1        0.991        28.64        138        1        1.06        0.94
n95       1        42       31       0        0        1        0.981        27.67        138        1        1.06        0.94
n96       1        38       15       0        0        1        0.993        27.51        138        1        1.06        0.94
n97       1        15       9        0        0        1        1.011        27.88        138        1        1.06        0.94
n98       1        34       8        0        0        1        1.024        27.4         138        1        1.06        0.94
n99       2        42       0        0        0        1        1.01         27.04        138        1        1.06        0.94
n100      2        37       18       0        0        1        1.017        28.03        138        1        1.06        0.94
n101      1        22       15       0        0        1        0.993        29.61        138        1        1.06        0.94
n102      1        5        3        0        0        1        0.991        32.3         138        1        1.06        0.94
n103      2        23       16       0        0        1        1.001        24.44        138        1        1.06        0.94
n104      2        38       25       0        0        1        0.971        21.69        138        1        1.06        0.94
n105      2        31       26       0        20       1        0.965        20.57        138        1        1.06        0.94
n106      1        43       16       0        0        1        0.962        20.32        138        1        1.06        0.94
n107      2        50       12       0        6        1        0.952        17.53        138        1        1.06        0.94
n108      1        2        1        0        0        1        0.967        19.38        138        1        1.06        0.94
n109      1        8        3        0        0        1        0.967        18.93        138        1        1.06        0.94
n110      2        39       30       0        6        1        0.973        18.09        138        1        1.06        0.94
n111      2        0        0        0        0        1        0.98         19.74        138        1        1.06        0.94
n112      2        68       13       0        0        1        0.975        14.99        138        1        1.06        0.94
n113      2        6        0        0        0        1        0.993        13.74        138        1        1.06        0.94
n114      1        8        3        0        0        1        0.96         14.46        138        1        1.06        0.94
n115      1        22       7        0        0        1        0.96         14.46        138        1        1.06        0.94
n116      2        184      0        0        0        1        1.005        27.12        138        1        1.06        0.94
n117      1        20       8        0        0        1        0.974        10.67        138        1        1.06        0.94
n118      1        33       15       0        0        1        0.949        21.92        138        1        1.06        0.94;
table gen(n,*) generator data
          Pg       Qg       Qmax      Qmin       Vg       mBase      status   Pmax       Pmin     Pc1      Pc2      Qc1min   Qc1max   Qc2min   Qc2max   ramp_agc ramp_10  ramp_30  ramp_q   apf
n1        0        0        15        -5         0.955    100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n4        0        0        300       -300       0.998    100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n6        0        0        50        -13        0.99     100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n8        0        0        300       -300       1.015    100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n10       450      0        200       -147       1.05     100        1        550        0        0        0        0        0        0        0        0        0        0        0        0
n12       85       0        120       -35        0.99     100        1        185        0        0        0        0        0        0        0        0        0        0        0        0
n15       0        0        30        -10        0.97     100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n18       0        0        50        -16        0.973    100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n19       0        0        24        -8         0.962    100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n24       0        0        300       -300       0.992    100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n25       220      0        140       -47        1.05     100        1        320        0        0        0        0        0        0        0        0        0        0        0        0
n26       314      0        1000      -1000      1.015    100        1        414        0        0        0        0        0        0        0        0        0        0        0        0
n27       0        0        300       -300       0.968    100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n31       7        0        300       -300       0.967    100        1        107        0        0        0        0        0        0        0        0        0        0        0        0
n32       0        0        42        -14        0.963    100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n34       0        0        24        -8         0.984    100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n36       0        0        24        -8         0.98     100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n40       0        0        300       -300       0.97     100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n42       0        0        300       -300       0.985    100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n46       19       0        100       -100       1.005    100        1        119        0        0        0        0        0        0        0        0        0        0        0        0
n49       204      0        210       -85        1.025    100        1        304        0        0        0        0        0        0        0        0        0        0        0        0
n54       48       0        300       -300       0.955    100        1        148        0        0        0        0        0        0        0        0        0        0        0        0
n55       0        0        23        -8         0.952    100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n56       0        0        15        -8         0.954    100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n59       155      0        180       -60        0.985    100        1        255        0        0        0        0        0        0        0        0        0        0        0        0
n61       160      0        300       -100       0.995    100        1        260        0        0        0        0        0        0        0        0        0        0        0        0
n62       0        0        20        -20        0.998    100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n65       391      0        200       -67        1.005    100        1        491        0        0        0        0        0        0        0        0        0        0        0        0
n66       392      0        200       -67        1.05     100        1        492        0        0        0        0        0        0        0        0        0        0        0        0
n69       516.4    0        300       -300       1.035    100        1        805.2      0        0        0        0        0        0        0        0        0        0        0        0
n70       0        0        32        -10        0.984    100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n72       0        0        100       -100       0.98     100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n73       0        0        100       -100       0.991    100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n74       0        0        9         -6         0.958    100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n76       0        0        23        -8         0.943    100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n77       0        0        70        -20        1.006    100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n80       477      0        280       -165       1.04     100        1        577        0        0        0        0        0        0        0        0        0        0        0        0
n85       0        0        23        -8         0.985    100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n87       4        0        1000      -100       1.015    100        1        104        0        0        0        0        0        0        0        0        0        0        0        0
n89       607      0        300       -210       1.005    100        1        707        0        0        0        0        0        0        0        0        0        0        0        0
n90       0        0        300       -300       0.985    100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n91       0        0        100       -100       0.98     100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n92       0        0        9         -3         0.99     100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n99       0        0        100       -100       1.01     100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n100      252      0        155       -50        1.017    100        1        352        0        0        0        0        0        0        0        0        0        0        0        0
n103      40       0        40        -15        1.01     100        1        140        0        0        0        0        0        0        0        0        0        0        0        0
n104      0        0        23        -8         0.971    100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n105      0        0        23        -8         0.965    100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n107      0        0        200       -200       0.952    100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n110      0        0        23        -8         0.973    100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n111      36       0        1000      -100       0.98     100        1        136        0        0        0        0        0        0        0        0        0        0        0        0
n112      0        0        1000      -100       0.975    100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n113      0        0        200       -100       0.993    100        1        100        0        0        0        0        0        0        0        0        0        0        0        0
n116      0        0        1000      -1000      1.005    100        1        100        0        0        0        0        0        0        0        0        0        0        0        0;
table line(n,n,*) branch data
               r             x           b             rateA     rateB    rateC    ratio    angle    status   angmin      angmax
n1.n2          0.0303        0.0999      0.0254         0        0        0        0        0        1        -360        360
n1.n3          0.0129        0.0424      0.01082        0        0        0        0        0        1        -360        360
n4.n5          0.00176       0.00798     0.0021         0        0        0        0        0        1        -360        360
n3.n5          0.0241        0.108       0.0284         0        0        0        0        0        1        -360        360
n5.n6          0.0119        0.054       0.01426        0        0        0        0        0        1        -360        360
n6.n7          0.00459       0.0208      0.0055         0        0        0        0        0        1        -360        360
n8.n9          0.00244       0.0305      1.162          0        0        0        0        0        1        -360        360
n8.n5          0             0.0267      0              0        0        0        0.985    0        1        -360        360
n9.n10         0.00258       0.0322      1.23           0        0        0        0        0        1        -360        360
n4.n11         0.0209        0.0688      0.01748        0        0        0        0        0        1        -360        360
n5.n11         0.0203        0.0682      0.01738        0        0        0        0        0        1        -360        360
n11.n12        0.00595       0.0196      0.00502        0        0        0        0        0        1        -360        360
n2.n12         0.0187        0.0616      0.01572        0        0        0        0        0        1        -360        360
n3.n12         0.0484        0.16        0.0406         0        0        0        0        0        1        -360        360
n7.n12         0.00862       0.034       0.00874        0        0        0        0        0        1        -360        360
n11.n13        0.02225       0.0731      0.01876        0        0        0        0        0        1        -360        360
n12.n14        0.0215        0.0707      0.01816        0        0        0        0        0        1        -360        360
n13.n15        0.0744        0.2444      0.06268        0        0        0        0        0        1        -360        360
n14.n15        0.0595        0.195       0.0502         0        0        0        0        0        1        -360        360
n12.n16        0.0212        0.0834      0.0214         0        0        0        0        0        1        -360        360
n15.n17        0.0132        0.0437      0.0444         0        0        0        0        0        1        -360        360
n16.n17        0.0454        0.1801      0.0466         0        0        0        0        0        1        -360        360
n17.n18        0.0123        0.0505      0.01298        0        0        0        0        0        1        -360        360
n18.n19        0.01119       0.0493      0.01142        0        0        0        0        0        1        -360        360
n19.n20        0.0252        0.117       0.0298         0        0        0        0        0        1        -360        360
n15.n19        0.012         0.0394      0.0101         0        0        0        0        0        1        -360        360
n20.n21        0.0183        0.0849      0.0216         0        0        0        0        0        1        -360        360
n21.n22        0.0209        0.097       0.0246         0        0        0        0        0        1        -360        360
n22.n23        0.0342        0.159       0.0404         0        0        0        0        0        1        -360        360
n23.n24        0.0135        0.0492      0.0498         0        0        0        0        0        1        -360        360
n23.n25        0.0156        0.08        0.0864         0        0        0        0        0        1        -360        360
n26.n25        0             0.0382      0              0        0        0        0.96     0        1        -360        360
n25.n27        0.0318        0.163       0.1764         0        0        0        0        0        1        -360        360
n27.n28        0.01913       0.0855      0.0216         0        0        0        0        0        1        -360        360
n28.n29        0.0237        0.0943      0.0238         0        0        0        0        0        1        -360        360
n30.n17        0             0.0388      0              0        0        0        0.96     0        1        -360        360
n8.n30         0.00431       0.0504      0.514          0        0        0        0        0        1        -360        360
n26.n30        0.00799       0.086       0.908          0        0        0        0        0        1        -360        360
n17.n31        0.0474        0.1563      0.0399         0        0        0        0        0        1        -360        360
n29.n31        0.0108        0.0331      0.0083         0        0        0        0        0        1        -360        360
n23.n32        0.0317        0.1153      0.1173         0        0        0        0        0        1        -360        360
n31.n32        0.0298        0.0985      0.0251         0        0        0        0        0        1        -360        360
n27.n32        0.0229        0.0755      0.01926        0        0        0        0        0        1        -360        360
n15.n33        0.038         0.1244      0.03194        0        0        0        0        0        1        -360        360
n19.n34        0.0752        0.247       0.0632         0        0        0        0        0        1        -360        360
n35.n36        0.00224       0.0102      0.00268        0        0        0        0        0        1        -360        360
n35.n37        0.011         0.0497      0.01318        0        0        0        0        0        1        -360        360
n33.n37        0.0415        0.142       0.0366         0        0        0        0        0        1        -360        360
n34.n36        0.00871       0.0268      0.00568        0        0        0        0        0        1        -360        360
n34.n37        0.00256       0.0094      0.00984        0        0        0        0        0        1        -360        360
n38.n37        0             0.0375      0              0        0        0        0.935    0        1        -360        360
n37.n39        0.0321        0.106       0.027          0        0        0        0        0        1        -360        360
n37.n40        0.0593        0.168       0.042          0        0        0        0        0        1        -360        360
n30.n38        0.00464       0.054       0.422          0        0        0        0        0        1        -360        360
n39.n40        0.0184        0.0605      0.01552        0        0        0        0        0        1        -360        360
n40.n41        0.0145        0.0487      0.01222        0        0        0        0        0        1        -360        360
n40.n42        0.0555        0.183       0.0466         0        0        0        0        0        1        -360        360
n41.n42        0.041         0.135       0.0344         0        0        0        0        0        1        -360        360
n43.n44        0.0608        0.2454      0.06068        0        0        0        0        0        1        -360        360
n34.n43        0.0413        0.1681      0.04226        0        0        0        0        0        1        -360        360
n44.n45        0.0224        0.0901      0.0224         0        0        0        0        0        1        -360        360
n45.n46        0.04          0.1356      0.0332         0        0        0        0        0        1        -360        360
n46.n47        0.038         0.127       0.0316         0        0        0        0        0        1        -360        360
n46.n48        0.0601        0.189       0.0472         0        0        0        0        0        1        -360        360
n47.n49        0.0191        0.0625      0.01604        0        0        0        0        0        1        -360        360
n42.n49        0.0715        0.323       0.086          0        0        0        0        0        1        -360        360
n49.n42        0.0715        0.323       0.086          0        0        0        0        0        1        -360        360
*n42.n49        0.0715        0.323       0.086          0        0        0        0        0        1        -360        360
n45.n49        0.0684        0.186       0.0444         0        0        0        0        0        1        -360        360
n48.n49        0.0179        0.0505      0.01258        0        0        0        0        0        1        -360        360
n49.n50        0.0267        0.0752      0.01874        0        0        0        0        0        1        -360        360
n49.n51        0.0486        0.137       0.0342         0        0        0        0        0        1        -360        360
n51.n52        0.0203        0.0588      0.01396        0        0        0        0        0        1        -360        360
n52.n53        0.0405        0.1635      0.04058        0        0        0        0        0        1        -360        360
n53.n54        0.0263        0.122       0.031          0        0        0        0        0        1        -360        360
n49.n54        0.073         0.289       0.0738         0        0        0        0        0        1        -360        360
n54.n49        0.0869        0.291       0.073          0        0        0        0        0        1        -360        360
*n49.n54        0.0869        0.291       0.073          0        0        0        0        0        1        -360        360
n54.n55        0.0169        0.0707      0.0202         0        0        0        0        0        1        -360        360
n54.n56        0.00275       0.00955     0.00732        0        0        0        0        0        1        -360        360
n55.n56        0.00488       0.0151      0.00374        0        0        0        0        0        1        -360        360
n56.n57        0.0343        0.0966      0.0242         0        0        0        0        0        1        -360        360
n50.n57        0.0474        0.134       0.0332         0        0        0        0        0        1        -360        360
n56.n58        0.0343        0.0966      0.0242         0        0        0        0        0        1        -360        360
n51.n58        0.0255        0.0719      0.01788        0        0        0        0        0        1        -360        360
n54.n59        0.0503        0.2293      0.0598         0        0        0        0        0        1        -360        360
n56.n59        0.0825        0.251       0.0569         0        0        0        0        0        1        -360        360
n59.n56        0.0803        0.239       0.0536         0        0        0        0        0        1        -360        360
*n56.n59        0.0803        0.239       0.0536         0        0        0        0        0        1        -360        360
n55.n59        0.04739       0.2158      0.05646        0        0        0        0        0        1        -360        360
n59.n60        0.0317        0.145       0.0376         0        0        0        0        0        1        -360        360
n59.n61        0.0328        0.15        0.0388         0        0        0        0        0        1        -360        360
n60.n61        0.00264       0.0135      0.01456        0        0        0        0        0        1        -360        360
n60.n62        0.0123        0.0561      0.01468        0        0        0        0        0        1        -360        360
n61.n62        0.00824       0.0376      0.0098         0        0        0        0        0        1        -360        360
n63.n59        0             0.0386      0              0        0        0        0.96     0        1        -360        360
n63.n64        0.00172       0.02        0.216          0        0        0        0        0        1        -360        360
n64.n61        0             0.0268      0              0        0        0        0.985    0        1        -360        360
n38.n65        0.00901       0.0986      1.046          0        0        0        0        0        1        -360        360
n64.n65        0.00269       0.0302      0.38           0        0        0        0        0        1        -360        360
n49.n66        0.018         0.0919      0.0248         0        0        0        0        0        1        -360        360
n66.n49        0.018         0.0919      0.0248         0        0        0        0        0        1        -360        360
*n49.n66        0.018         0.0919      0.0248         0        0        0        0        0        1        -360        360
n62.n66        0.0482        0.218       0.0578         0        0        0        0        0        1        -360        360
n62.n67        0.0258        0.117       0.031          0        0        0        0        0        1        -360        360
n65.n66        0             0.037       0              0        0        0        0.935    0        1        -360        360
n66.n67        0.0224        0.1015      0.02682        0        0        0        0        0        1        -360        360
n65.n68        0.00138       0.016       0.638          0        0        0        0        0        1        -360        360
n47.n69        0.0844        0.2778      0.07092        0        0        0        0        0        1        -360        360
n49.n69        0.0985        0.324       0.0828         0        0        0        0        0        1        -360        360
n68.n69        0             0.037       0              0        0        0        0.935    0        1        -360        360
n69.n70        0.03          0.127       0.122          0        0        0        0        0        1        -360        360
n24.n70        0.00221       0.4115      0.10198        0        0        0        0        0        1        -360        360
n70.n71        0.00882       0.0355      0.00878        0        0        0        0        0        1        -360        360
n24.n72        0.0488        0.196       0.0488         0        0        0        0        0        1        -360        360
n71.n72        0.0446        0.18        0.04444        0        0        0        0        0        1        -360        360
n71.n73        0.00866       0.0454      0.01178        0        0        0        0        0        1        -360        360
n70.n74        0.0401        0.1323      0.03368        0        0        0        0        0        1        -360        360
n70.n75        0.0428        0.141       0.036          0        0        0        0        0        1        -360        360
n69.n75        0.0405        0.122       0.124          0        0        0        0        0        1        -360        360
n74.n75        0.0123        0.0406      0.01034        0        0        0        0        0        1        -360        360
n76.n77        0.0444        0.148       0.0368         0        0        0        0        0        1        -360        360
n69.n77        0.0309        0.101       0.1038         0        0        0        0        0        1        -360        360
n75.n77        0.0601        0.1999      0.04978        0        0        0        0        0        1        -360        360
n77.n78        0.00376       0.0124      0.01264        0        0        0        0        0        1        -360        360
n78.n79        0.00546       0.0244      0.00648        0        0        0        0        0        1        -360        360
n77.n80        0.017         0.0485      0.0472         0        0        0        0        0        1        -360        360
n80.n77        0.0294        0.105       0.0228         0        0        0        0        0        1        -360        360
*n77.n80        0.0294        0.105       0.0228         0        0        0        0        0        1        -360        360
n79.n80        0.0156        0.0704      0.0187         0        0        0        0        0        1        -360        360
n68.n81        0.00175       0.0202      0.808          0        0        0        0        0        1        -360        360
n81.n80        0             0.037       0              0        0        0        0.935    0        1        -360        360
n77.n82        0.0298        0.0853      0.08174        0        0        0        0        0        1        -360        360
n82.n83        0.0112        0.03665     0.03796        0        0        0        0        0        1        -360        360
n83.n84        0.0625        0.132       0.0258         0        0        0        0        0        1        -360        360
n83.n85        0.043         0.148       0.0348         0        0        0        0        0        1        -360        360
n84.n85        0.0302        0.0641      0.01234        0        0        0        0        0        1        -360        360
n85.n86        0.035         0.123       0.0276         0        0        0        0        0        1        -360        360
n86.n87        0.02828       0.2074      0.0445         0        0        0        0        0        1        -360        360
n85.n88        0.02          0.102       0.0276         0        0        0        0        0        1        -360        360
n85.n89        0.0239        0.173       0.047          0        0        0        0        0        1        -360        360
n88.n89        0.0139        0.0712      0.01934        0        0        0        0        0        1        -360        360
n89.n90        0.0518        0.188       0.0528         0        0        0        0        0        1        -360        360
n90.n89        0.0238        0.0997      0.106          0        0        0        0        0        1        -360        360
*n89.n90        0.0238        0.0997      0.106          0        0        0        0        0        1        -360        360
n90.n91        0.0254        0.0836      0.0214         0        0        0        0        0        1        -360        360
n89.n92        0.0099        0.0505      0.0548         0        0        0        0        0        1        -360        360
n92.n89        0.0393        0.1581      0.0414         0        0        0        0        0        1        -360        360
*n89.n92        0.0393        0.1581      0.0414         0        0        0        0        0        1        -360        360
n91.n92        0.0387        0.1272      0.03268        0        0        0        0        0        1        -360        360
n92.n93        0.0258        0.0848      0.0218         0        0        0        0        0        1        -360        360
n92.n94        0.0481        0.158       0.0406         0        0        0        0        0        1        -360        360
n93.n94        0.0223        0.0732      0.01876        0        0        0        0        0        1        -360        360
n94.n95        0.0132        0.0434      0.0111         0        0        0        0        0        1        -360        360
n80.n96        0.0356        0.182       0.0494         0        0        0        0        0        1        -360        360
n82.n96        0.0162        0.053       0.0544         0        0        0        0        0        1        -360        360
n94.n96        0.0269        0.0869      0.023          0        0        0        0        0        1        -360        360
n80.n97        0.0183        0.0934      0.0254         0        0        0        0        0        1        -360        360
n80.n98        0.0238        0.108       0.0286         0        0        0        0        0        1        -360        360
n80.n99        0.0454        0.206       0.0546         0        0        0        0        0        1        -360        360
n92.n100       0.0648        0.295       0.0472         0        0        0        0        0        1        -360        360
n94.n100       0.0178        0.058       0.0604         0        0        0        0        0        1        -360        360
n95.n96        0.0171        0.0547      0.01474        0        0        0        0        0        1        -360        360
n96.n97        0.0173        0.0885      0.024          0        0        0        0        0        1        -360        360
n98.n100       0.0397        0.179       0.0476         0        0        0        0        0        1        -360        360
n99.n100       0.018         0.0813      0.0216         0        0        0        0        0        1        -360        360
n100.n101      0.0277        0.1262      0.0328         0        0        0        0        0        1        -360        360
n92.n102       0.0123        0.0559      0.01464        0        0        0        0        0        1        -360        360
n101.n102      0.0246        0.112       0.0294         0        0        0        0        0        1        -360        360
n100.n103      0.016         0.0525      0.0536         0        0        0        0        0        1        -360        360
n100.n104      0.0451        0.204       0.0541         0        0        0        0        0        1        -360        360
n103.n104      0.0466        0.1584      0.0407         0        0        0        0        0        1        -360        360
n103.n105      0.0535        0.1625      0.0408         0        0        0        0        0        1        -360        360
n100.n106      0.0605        0.229       0.062          0        0        0        0        0        1        -360        360
n104.n105      0.00994       0.0378      0.00986        0        0        0        0        0        1        -360        360
n105.n106      0.014         0.0547      0.01434        0        0        0        0        0        1        -360        360
n105.n107      0.053         0.183       0.0472         0        0        0        0        0        1        -360        360
n105.n108      0.0261        0.0703      0.01844        0        0        0        0        0        1        -360        360
n106.n107      0.053         0.183       0.0472         0        0        0        0        0        1        -360        360
n108.n109      0.0105        0.0288      0.0076         0        0        0        0        0        1        -360        360
n103.n110      0.03906       0.1813      0.0461         0        0        0        0        0        1        -360        360
n109.n110      0.0278        0.0762      0.0202         0        0        0        0        0        1        -360        360
n110.n111      0.022         0.0755      0.02           0        0        0        0        0        1        -360        360
n110.n112      0.0247        0.064       0.062          0        0        0        0        0        1        -360        360
n17.n113       0.00913       0.0301      0.00768        0        0        0        0        0        1        -360        360
n32.n113       0.0615        0.203       0.0518         0        0        0        0        0        1        -360        360
n32.n114       0.0135        0.0612      0.01628        0        0        0        0        0        1        -360        360
n27.n115       0.0164        0.0741      0.01972        0        0        0        0        0        1        -360        360
n114.n115      0.0023        0.0104      0.00276        0        0        0        0        0        1        -360        360
n68.n116       0.00034       0.00405     0.164          0        0        0        0        0        1        -360        360
n12.n117       0.0329        0.14        0.0358         0        0        0        0        0        1        -360        360
n75.n118       0.0145        0.0481      0.01198        0        0        0        0        0        1        -360        360
n76.n118       0.0164        0.0544      0.01356        0        0        0        0        0        1        -360        360;
parameter
y(n,np);
*theta(n,np)

y(n,np)$line(n,np,'x')=sqrt(sqr(line(n,np,'r'))/sqr(sqr(line(n,np,'r'))+sqr(line(n,np,'x')))+sqr((line(n,np,'b')$(ord(n) eq ord(np))/2)-(line(n,np,'x')/(sqr(line(n,np,'r'))+sqr(line(n,np,'x'))))));
y(n,np)$(line(n,np,'x') and line(n,np,'ratio'))=sqrt(sqr(line(n,np,'r'))/sqr(sqr(line(n,np,'r'))+sqr(line(n,np,'x')))+sqr((line(n,np,'b')$(ord(n) eq ord(np))/2)-(line(n,np,'x')/(sqr(line(n,np,'r'))+sqr(line(n,np,'x'))))))*(1/line(n,np,'ratio'));
y(n,np)$(ord(n) gt ord(np))=y(np,n);
y(n,n)=sqrt(sqr(bus(n,'Gs'))+sqr(bus(n,'Bs')))/baseMVA+
sum(np,sqrt(sqr(line(n,np,'r'))/sqr(sqr(line(n,np,'r'))+sqr(line(n,np,'x')))+sqr((line(n,np,'b')$(ord(n) ne ord(np))/2)-(line(n,np,'x')/(sqr(line(n,np,'r'))+sqr(line(n,np,'x'))))))$line(n,np,'x')+
       sqrt(sqr(line(np,n,'r'))/sqr(sqr(line(np,n,'r'))+sqr(line(np,n,'x')))+sqr((line(np,n,'b')$(ord(n) ne ord(np))/2)-(line(np,n,'x')/(sqr(line(np,n,'r'))+sqr(line(np,n,'x'))))))$line(np,n,'x'));
*loop(n,
*y(n,np)$line(n,np,'x')=sqrt(sqr(line(n,np,'r'))/sqr(sqr(line(n,np,'r'))+sqr(line(n,np,'x')))+sqr((line(n,np,'b')/2)-(line(n,np,'x')/(sqr(line(n,np,'r'))+sqr(line(n,np,'x'))))));
*);
*loop(np,
*y(np,n)$line(n,np,'x')=sqrt(sqr(line(n,np,'r'))/sqr(sqr(line(n,np,'r'))+sqr(line(n,np,'x')))+sqr((line(n,np,'b')$(ord(n) eq ord(np))/2)-(line(n,np,'x')/(sqr(line(n,np,'r'))+sqr(line(n,np,'x'))))));
*);

*loop(n,
*theta(n,np)$line(n,np,'x')=arctan(((line(n,np,'b')$(ord(n) eq ord(np))/2)+(-line(n,np,'x')/(sqr(line(n,np,'r'))+sqr(line(n,np,'x')))))/(line(n,np,'r')/(sqr(line(n,np,'r'))+sqr(line(n,np,'x')))));
*theta(n,np)$(mapVal(theta(n,np)) eq 4)=pi/2;);
*loop(np,
*theta(np,n)$line(n,np,'x')=arctan(((line(n,np,'b')/2)+(-line(n,np,'x')/(sqr(line(n,np,'r'))+sqr(line(n,np,'x')))))/(line(n,np,'r')/(sqr(line(n,np,'r'))+sqr(line(n,np,'x')))));
*theta(np,n)$(mapVal(theta(np,n)) eq 4)=pi/2;);

*theta(n,n)=arctan(sum(np$line(n,np,'x'),((bus(n,'Bs')/baseMVA)+(line(n,np,'b')/2)+(-line(n,np,'x')/(sqr(line(n,np,'r'))+sqr(line(n,np,'x'))))))/sum(np$line(n,np,'x'),((bus(n,'Gs')/baseMVA)+(line(n,np,'r')/(sqr(line(n,np,'r'))+sqr(line(n,np,'x')))))));
*theta(n,n)$(mapVal(theta(n,n)) eq 4)=-pi/2;
table theta(n,n)
              n1          n2          n3          n4          n5          n6

n1        -1.276      -1.276      -1.275
n2        -1.276      -1.276
n3        -1.275                  -1.321                  -1.351
n4                                            -1.346      -1.354
n5                                -1.351      -1.354      -1.328      -1.354
n6                                                        -1.354      -1.354
n7                                                                    -1.354
n8                                                         1.571
n11                                           -1.276      -1.281
n12                   -1.276      -1.276

   +          n7          n8          n9         n10         n11         n12

n2                                                                    -1.276
n3                                                                    -1.277
n4                                                        -1.276
n5                     1.571                              -1.281
n6        -1.354
n7        -1.322                                                      -1.322
n8                    -1.523      -1.491
n9                    -1.490      -1.489      -1.491
n10                               -1.489      -1.571
n11                                                       -1.276      -1.276
n12       -1.322                                          -1.276      -1.306
n13                                                       -1.275
n14                                                                   -1.275
n16                                                                   -1.322
n30                   -1.484
n117                                                                  -1.339

   +         n13         n14         n15         n16         n17         n18

n11       -1.275
n12                   -1.276                  -1.322
n13       -1.273                  -1.275
n14                   -1.273      -1.275
n15       -1.273      -1.273      -1.276                  -1.277
n16                                           -1.323      -1.324
n17                               -1.277      -1.323      -1.295      -1.332
n18                                                       -1.332      -1.348
n19                               -1.275                              -1.348
n30                                                        1.571
n31                                                       -1.275
n33                               -1.274
n113                                                      -1.276

   +         n19         n20         n21         n22         n23         n24

n15       -1.275
n18       -1.348
n19       -1.331      -1.359
n20       -1.358      -1.358      -1.358
n21                   -1.358      -1.358      -1.359
n22                               -1.358      -1.358      -1.359
n23                                           -1.358      -1.325      -1.303
n24                                                       -1.303      -1.403
n25                                                       -1.378
n32                                                       -1.301
n34       -1.273
n70                                                                   -1.565
n72                                                                   -1.326

   +         n25         n26         n27         n28         n29         n30

n8                                                                    -1.485
n17                                                                    1.571
n23       -1.378
n25       -1.375       1.571      -1.378
n26        1.571      -1.542                                          -1.478
n27       -1.375                  -1.326      -1.351
n28                               -1.350      -1.324      -1.325
n29                                           -1.324      -1.255
n30                   -1.474                                          -1.535
n31                                                       -1.255
n32                               -1.276
n38                                                                   -1.484
n115                              -1.353

   +         n31         n32         n33         n34         n35         n36

n15                               -1.274
n17       -1.276
n19                                           -1.275
n23                   -1.302
n27                   -1.276
n29       -1.255
n31       -1.277      -1.277
n32       -1.277      -1.336
n33                               -1.286
n34                                           -1.293                  -1.257
n35                                                       -1.354      -1.355
n36                                           -1.257      -1.355      -1.571
n37                               -1.286      -1.305      -1.353
n43                                           -1.329
n113                  -1.275
n114                  -1.354

   +         n37         n38         n39         n40         n41         n42

n30                   -1.485
n33       -1.286
n34       -1.305
n35       -1.353
n37       -1.269       1.571      -1.277      -1.231
n38        1.571      -1.545
n39       -1.276                  -1.275      -1.276
n40       -1.230                  -1.275      -1.280      -1.281      -1.276
n41                                           -1.281      -1.275      -1.276
n42                                           -1.275      -1.275      -1.350
n49                                                                   -1.350
n65                   -1.475

   +         n43         n44         n45         n46         n47         n48

n34       -1.330
n43       -1.326      -1.328
n44       -1.326      -1.325      -1.327
n45                   -1.327      -1.250      -1.284
n46                               -1.283      -1.268      -1.280      -1.263
n47                                           -1.279      -1.274
n48                                           -1.261                  -1.227
n49                               -1.217                  -1.274      -1.230
n69                                                       -1.273

   +         n49         n50         n51         n52         n53         n54

n42       -1.350
n45       -1.218
n47       -1.274
n48       -1.230
n49       -1.289      -1.230      -1.230                              -1.277
n50       -1.229      -1.230
n51       -1.229                  -1.234      -1.238
n52                               -1.238      -1.327      -1.328
n53                                           -1.327      -1.358      -1.358
n54       -1.321                                          -1.358      -1.297
n55                                                                   -1.336
n56                                                                   -1.290
n57                   -1.230
n58                               -1.230
n59                                                                   -1.353
n66       -1.377
n69       -1.272

   +         n55         n56         n57         n58         n59         n60

n50                               -1.231
n51                                           -1.230
n54       -1.336      -1.290                              -1.355
n55       -1.265      -1.258                              -1.355
n56       -1.258      -1.233      -1.230      -1.230      -1.244
n57                   -1.229      -1.571
n58                   -1.229                  -1.571
n59       -1.353      -1.251                              -1.330      -1.356
n60                                                       -1.355      -1.373
n61                                                       -1.355      -1.378
n62                                                                   -1.355
n63                                                        1.571

   +         n61         n62         n63         n64         n65         n66

n38                                                       -1.480
n49                                                                   -1.377
n59       -1.356                   1.571
n60       -1.378      -1.355
n61       -1.355      -1.355                   1.571
n62       -1.355      -1.353                                          -1.353
n63                               -1.514      -1.485
n64        1.571                  -1.485      -1.529      -1.482
n65                                           -1.481      -1.511       1.571
n66                   -1.352                               1.571      -1.366
n67                   -1.353                                          -1.353
n68                                                       -1.484

   +         n67         n68         n69         n70         n71         n72

n24                                           -1.565                  -1.327
n47                               -1.276
n49                               -1.276
n62       -1.354
n65                   -1.485
n66       -1.354
n67       -1.571
n68                   -1.494       1.571
n69                    1.571      -1.285      -1.339
n70                               -1.337      -1.310      -1.327
n71                                           -1.327      -1.371      -1.328
n72                                                       -1.327      -1.571
n73                                                       -1.382
n74                                           -1.276
n75                               -1.248      -1.275
n77                               -1.272
n81                   -1.484
n116                  -1.487

   +         n73         n74         n75         n76         n77         n78

n69                               -1.250                  -1.274
n70                   -1.276      -1.276
n71       -1.382
n73       -1.571
n74                   -1.275      -1.277
n75                   -1.277      -1.278                  -1.279
n76                                           -1.278      -1.279
n77                               -1.277      -1.279      -1.264      -1.276
n78                                                       -1.276      -1.351
n79                                                                   -1.351
n80                                                       -1.233
n82                                                       -1.233
n118                              -1.278      -1.278

   +         n79         n80         n81         n82         n83         n84

n68                               -1.484
n77                   -1.297                  -1.235
n78       -1.351
n79       -1.349      -1.353
n80       -1.353      -1.350       1.571
n81                    1.571      -1.571
n82                                           -1.271      -1.274
n83                                           -1.274      -1.200      -1.129
n84                                                       -1.128      -1.130
n85                                                       -1.287      -1.130
n96                   -1.377                  -1.274
n97                   -1.377
n98                   -1.354
n99                   -1.353

   +         n85         n86         n87         n88         n89         n90

n83       -1.288
n84       -1.131
n85       -1.362      -1.294                  -1.377      -1.434
n86       -1.293      -1.435      -1.435
n87                   -1.435      -1.571
n88       -1.377                              -1.378      -1.378
n89       -1.433                              -1.378      -1.361      -1.335
n90                                                       -1.301      -1.303
n91                                                                   -1.276
n92                                                       -1.377

   +         n91         n92         n93         n94         n95         n96

n80                                                                   -1.378
n82                                                                   -1.274
n89                   -1.326
n90       -1.276
n91       -1.275      -1.275
n92       -1.275      -1.319      -1.275      -1.275
n93                   -1.275      -1.275      -1.275
n94                   -1.274      -1.275      -1.273      -1.276      -1.271
n95                                           -1.275      -1.268      -1.268
n96                                           -1.270      -1.268      -1.378
n97                                                                   -1.378
n100                  -1.353                  -1.272
n102                  -1.354

   +         n97         n98         n99        n100        n101        n102

n80       -1.377      -1.354      -1.354
n92                                           -1.355                  -1.354
n94                                           -1.273
n96       -1.378
n97       -1.571
n98                   -1.352                  -1.353
n99                               -1.353      -1.353
n100                  -1.352      -1.353      -1.307      -1.355
n101                                          -1.354      -1.354      -1.355
n102                                                      -1.354      -1.571
n103                                          -1.275
n104                                          -1.352
n106                                          -1.311

   +        n103        n104        n105        n106        n107        n108

n100      -1.275      -1.353                  -1.313
n103      -1.296      -1.285      -1.253
n104      -1.284      -1.314      -1.314
n105      -1.252      -1.314      -1.272      -1.320      -1.289      -1.215
n106                              -1.320      -1.288      -1.289
n107                              -1.288      -1.288      -1.571
n108                              -1.215                              -1.221
n109                                                                  -1.221
n110      -1.358

   +        n109        n110        n111        n112        n113        n114

n17                                                       -1.276
n32                                                       -1.277      -1.354
n103                  -1.359
n108      -1.221
n109      -1.221      -1.221
n110      -1.221      -1.240      -1.287      -1.202
n111                  -1.287      -1.571
n112                  -1.202                  -1.571
n113                                                      -1.571
n114                                                                  -1.353
n115                                                                  -1.353

   +        n115        n116        n117        n118

n12                               -1.340
n27       -1.353
n68                   -1.487
n75                                           -1.278
n76                                           -1.278
n114      -1.353
n115      -1.571
n116                  -1.571
n117                              -1.571
n118                                          -1.571;

variable
*z    objective function variable
vmag(n) voltage magnitude at bus N
vang(n) voltage angle at bus N
p(n)
q(n);
** voltage bounds
vang.lo(n)=-pi;
vang.up(n)=pi;
vmag.l(n)$(bus(n,'type') eq 1)=bus(n,'Vm');
vang.l(n)$(bus(n,'type') eq 1)=0;
*vmag.lo(n)=bus(n,'Vmin');
*vmag.up(n)=bus(n,'Vmax');
** reference bus
vmag.fx(n)$(bus(n,'type') eq 3)=gen(n,'Vg');
vang.fx(n)$(bus(n,'type') eq 3)=bus(n,'Va')*(pi/180);
*p.lo(n)$(bus(n,'type') eq 3)=gen(n,'Pmin')/baseMVA;
*p.up(n)$(bus(n,'type') eq 3)=gen(n,'Pmax')/baseMVA;
*q.lo(n)$(bus(n,'type') eq 3)=gen(n,'Qmin')/baseMVA;
*q.up(n)$(bus(n,'type') eq 3)=gen(n,'Qmax')/baseMVA;
** pv busses
vmag.fx(n)$(bus(n,'type') eq 2)=gen(n,'Vg');
p.fx(n)$(bus(n,'type') eq 2)=gen(n,'Pg')/baseMVA-bus(n,'Pd')/baseMVA;
*q.lo(n)$(bus(n,'type') eq 2)=gen(n,'Qmin')/baseMVA;
*q.up(n)$(bus(n,'type') eq 2)=gen(n,'Qmax')/baseMVA;
** pq busses
p.fx(n)$(bus(n,'type') eq 1)=-bus(n,'Pd')/baseMVA;
q.fx(n)$(bus(n,'type') eq 1)=-bus(n,'Qd')/baseMVA;
vmag.lo(n)$(bus(n,'type') eq 1)=bus(n,'Vmin');
vmag.up(n)$(bus(n,'type') eq 1)=bus(n,'Vmax');

equations
*obj
activepower(n)
*activepower1(n)
reactivepower(n);
*reactivepower1(n)
*obj..z=e=0;
*activepower(n)..p(n)=e=vmag(n)*sum(np,vmag(np)*y(n,np)*cos(vang(np)-vang(n)+theta(n,np)));
*reactivepower(n)..q(n)=e=-vmag(n)*sum(np,vmag(np)*y(n,np)*sin(vang(np)-vang(n)+theta(n,np)));
activepower(n)$(bus(n,'type') ne 3)..p(n)=e=sum(np,(sqr(vmag(n))*y(n,np)*cos(-theta(n,np))-vmag(n)*vmag(np)*y(n,np)*cos(-theta(n,np)+vang(n)-vang(np)))$line(n,np,'x'))-sum(np,(sqr(vmag(np))*y(np,n)*cos(-theta(np,n))-vmag(np)*vmag(n)*y(np,n)*cos(-theta(np,n)+vang(np)-vang(n)))$line(np,n,'x'));
*activepower1(n)$(bus(n,'type') ne 3 and ord(n) eq 38)..p(n)=e=sum(np,(sqr(vmag(n))*y(n,np)*cos(-theta(n,np))-vmag(n)*vmag(np)*y(n,np)*cos(-theta(n,np)+vang(n)-vang(np)))$line(n,np,'x'))-sum(np,(sqr(vmag(np))*y(np,n)*cos(-theta(np,n))-vmag(np)*vmag(n)*y(np,n)*cos(-theta(np,n)+vang(np)-vang(n)))$line(np,n,'x'));
reactivepower(n)$(bus(n,'type') eq 1)..q(n)=e=sum(np,(sqr(vmag(n))*y(n,np)*sin(-theta(n,np))-vmag(n)*vmag(np)*y(n,np)*sin(-theta(n,np)+vang(n)-vang(np)))$line(n,np,'x'))-sum(np,(sqr(vmag(np))*y(np,n)*sin(-theta(np,n))-vmag(np)*vmag(n)*y(np,n)*sin(-theta(np,n)+vang(np)-vang(n)))$line(np,n,'x'));
*reactivepower1(n)$(bus(n,'type') eq 1 and ord(n) eq 38)..q(n)=e=sum(np,(sqr(vmag(n))*y(n,np)*sin(-theta(n,np))-vmag(n)*vmag(np)*y(n,np)*sin(-theta(n,np)+vang(n)-vang(np)))$line(n,np,'x'))-sum(np,(sqr(vmag(np))*y(np,n)*sin(-theta(np,n))-vmag(np)*vmag(n)*y(np,n)*sin(-theta(np,n)+vang(np)-vang(n)))$line(np,n,'x'));
*ractivepower(n)$(bus(n,'type') ne 3)..p(n)=e=sum(np,(sqr(vmag(n))*y(n,np)*cos(-theta(n,np))-vmag(n)*vmag(np)*y(n,np)*cos(-theta(n,np)+vang(n)-vang(np)))$(line(n,np,'x') or line(np,n,'x')));
*reactivepower(n)$(bus(n,'type') eq 1)..q(n)=e=sum(np,(sqr(vmag(n))*y(n,np)*sin(-theta(n,np))-vmag(n)*vmag(np)*y(n,np)*sin(-theta(n,np)+vang(n)-vang(np)))$(line(n,np,'x') or line(np,n,'x')));

model PF /all/;
option cns = KNITRO;
solve PF using cns;
*  nlp minimizing z;mcp
p.l(n)$(bus(n,'type') eq 3)=sum(np,(sqr(vmag.l(n))*y(n,np)*cos(-theta(n,np))-vmag.l(n)*vmag.l(np)*y(n,np)*cos(-theta(n,np)+vang.l(n)-vang.l(np)))$line(n,np,'x'))-sum(np,(sqr(vmag.l(np))*y(np,n)*cos(-theta(np,n))-vmag.l(np)*vmag.l(n)*y(np,n)*cos(-theta(np,n)+vang.l(np)-vang.l(n)))$line(np,n,'x'));
q.l(n)$(bus(n,'type') ne 1)=sum(np,(sqr(vmag.l(n))*y(n,np)*sin(-theta(n,np))-vmag.l(n)*vmag.l(np)*y(n,np)*sin(-theta(n,np)+vang.l(n)-vang.l(np)))$line(n,np,'x'))-sum(np,(sqr(vmag.l(np))*y(np,n)*sin(-theta(np,n))-vmag.l(np)*vmag.l(n)*y(np,n)*sin(-theta(np,n)+vang.l(np)-vang.l(n)))$line(np,n,'x'));
display y,theta,p.l,q.l,vmag.l,vang.l;
execute_unload vmag,vang
parameter
pline(n,np)
qline(n,np);
*pline(np,n)=sqr(vmag.l(n))*(1/line(n,np,'x'))$line(n,np,'x')*cos(-pi/2)-vmag.l(n)*vmag.l(np)*(1/line(n,np,'x'))$line(n,np,'x')*cos(-(pi/2)+vang.l(n)-vang.l(np));
*pline(n,np)$line(n,np,'x')=sqr(vmag.l(np))*(1/line(n,np,'x'))*cos(-pi/2)-vmag.l(np)*vmag.l(n)*(1/line(n,np,'x'))$line(n,np,'x')*cos(-(pi/2)+vang.l(np)-vang.l(n));
pline(n,np)=sqr(vmag.l(n))*y(n,np)*cos(-theta(n,np))-vmag.l(n)*vmag.l(np)*y(n,np)*cos(-theta(n,np)+vang.l(n)-vang.l(np));
pline(np,n)=sqr(vmag.l(np))*y(np,n)*cos(-theta(np,n))-vmag.l(np)*vmag.l(n)*y(np,n)*cos(-theta(np,n)+vang.l(np)-vang.l(n));
*qline(np,n)=sqr(vmag.l(n))*(1/line(n,np,'x'))$line(n,np,'x')*sin(-pi/2)-vmag.l(n)*vmag.l(np)*(1/line(n,np,'x'))$line(n,np,'x')*sin(-(pi/2)+vang.l(n)-vang.l(np));
*qline(n,np)$line(n,np,'x')=sqr(vmag.l(np))*(1/line(n,np,'x'))$line(n,np,'x')*sin(-pi/2)-vmag.l(np)*vmag.l(n)*(1/line(n,np,'x'))$line(n,np,'x')*sin(-(pi/2)+vang.l(np)-vang.l(n));
qline(n,np)=sqr(vmag.l(n))*y(n,np)*sin(-theta(n,np))-vmag.l(n)*vmag.l(np)*y(n,np)*sin(-theta(n,np)+vang.l(n)-vang.l(np));
qline(np,n)=sqr(vmag.l(np))*y(np,n)*sin(-theta(np,n))-vmag.l(np)*vmag.l(n)*y(np,n)*sin(-theta(np,n)+vang.l(np)-vang.l(n));
parameter
sigma_s(n),      sigma_sline(n,np)
sigma_vmag(n),   sigma_vang(n)

winv_s(n),       winv_sline(n,np)
winv_vmag(n),    winv_vang(n)

rand_s(n),       rand_sline(n,np)
rand_vmag(n),    rand_vang(n);

sigma_s(n)=(0.02*sqrt(sqr(p.l(n))+sqr(q.l(n)))+0.1560)/3;
sigma_sline(n,np)=(0.02*sqrt(sqr(pline(n,np))+sqr(qline(n,np)))+0.1560)/3;
sigma_vmag(n)=(0.02*1+0.0057)/3;sigma_vang(n)=(0.2*(pi/180)*3)/3;
*sigma_s(n)=0.02*sqrt(sqr(p.l(n))+sqr(q.l(n)));
*sigma_sline(n,np)=0.02*sqrt(sqr(pline(n,np))+sqr(qline(n,np)));
*sigma_vmag(n)=0.02*1;sigma_vang(n)=0.02*pi/180;

winv_s(n)=(1/sqr(sigma_s(n)))$p.l(n);winv_sline(n,np)=(1/sqr(sigma_sline(n,np)))$pline(n,np);
winv_vmag(n)=(1/sqr(sigma_vmag(n)))$vmag.l(n);winv_vang(n)=(1/sqr(sigma_vang(n)))$vang.l(n);

*execseed = 10E+8*(frac(jnow));
rand_s(n)=normal(0,sigma_s(n));rand_sline(n,np)=normal(0,sigma_sline(n,np));
rand_vmag(n)=normal(0,sigma_vmag(n));rand_vang(n)=normal(0,sigma_vang(n));
variable
e;
vmag.lo(n)$(bus(n,'type') eq 2)=bus('n4','Vmin');
vmag.up(n)$(bus(n,'type') eq 2)=bus('n4','Vmax')+0.1*bus('n4','Vmin');
p.lo(n)$(bus(n,'type') eq 2)=gen(n,'Pmin')/baseMVA;
p.up(n)$(bus(n,'type') eq 2)=gen(n,'Pmax')/baseMVA;
p.lo(n)$(bus(n,'type') eq 1)=-bus(n,'Pd')/baseMVA-0.1*bus(n,'Pd')/baseMVA;
p.up(n)$(bus(n,'type') eq 1)=-bus(n,'Pd')/baseMVA+0.1*bus(n,'Pd')/baseMVA;
q.lo(n)$(bus(n,'type') eq 1)=-bus(n,'Qd')/baseMVA-0.1*bus(n,'Qd')/baseMVA;
q.up(n)$(bus(n,'type') eq 1)=-bus(n,'Qd')/baseMVA+0.1*bus(n,'Qd')/baseMVA;
equation
error;
error..e=e=sum(n,
                 sum(np,winv_sline(n,np)*sqr(sqr(vmag(n))*y(n,np)*cos(-theta(n,np))-vmag(n)*vmag(np)*y(n,np)*cos(-theta(n,np)+vang(n)-vang(np))-pline(n,np)-rand_sline(n,np)))+
                 sum(np,winv_sline(np,n)*sqr(sqr(vmag(np))*y(np,n)*cos(-theta(np,n))-vmag(np)*vmag.l(n)*y(np,n)*cos(-theta(np,n)+vang(np)-vang(n))-pline(np,n)-rand_sline(np,n)))+
                 winv_s(n)*sqr(sum(np,(sqr(vmag(n))*y(n,np)*cos(-theta(n,np))-vmag(n)*vmag(np)*y(n,np)*cos(-theta(n,np)+vang(n)-vang(np)))$line(n,np,'x'))-sum(np,(sqr(vmag(np))*y(np,n)*cos(-theta(np,n))-vmag(np)*vmag(n)*y(np,n)*cos(-theta(np,n)+vang(np)-vang(n)))$line(np,n,'x'))-p.l(n)-rand_s(n))+
                 winv_vang(n)*sqr(vang(n)-vang.l(n)-rand_vang(n))+
                 sum(np,winv_sline(n,np)*sqr(sqr(vmag(n))*y(n,np)*sin(-theta(n,np))-vmag(n)*vmag(np)*y(n,np)*sin(-theta(n,np)+vang(n)-vang(np))-qline(n,np)-rand_sline(n,np)))+
                 sum(np,winv_sline(np,n)*sqr(sqr(vmag(np))*y(np,n)*sin(-theta(np,n))-vmag(np)*vmag(n)*y(np,n)*sin(-theta(np,n)+vang(np)-vang(n))-qline(np,n)-rand_sline(np,n)))+
                 winv_s(n)*sqr(sum(np,(sqr(vmag(n))*y(n,np)*sin(-theta(n,np))-vmag(n)*vmag(np)*y(n,np)*sin(-theta(n,np)+vang(n)-vang(np)))$line(n,np,'x'))-sum(np,(sqr(vmag(np))*y(np,n)*sin(-theta(np,n))-vmag(np)*vmag(n)*y(np,n)*sin(-theta(np,n)+vang(np)-vang(n)))$line(np,n,'x'))-q.l(n)-rand_s(n))+
                 winv_vmag(n)*sqr(vmag(n)-vmag.l(n)-rand_vmag(n))
                 );
model SE /error/;
option nlp = DICOPT;
solve SE using nlp minimizing e;
display vmag.l,vang.l;
*execute_unload vmag,vang